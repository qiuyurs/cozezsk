{"obj_edit_time":"1744463947","blocks":[{"block_id":"WCt0dwBHTollf9xtyzfclPkKnWe","block_type":1,"children":["FREkdDypboAYtvxkbW9c9bgfnPc","Dkh8d5mpuozUXXxGWkKcIlLRn4c","SmfJd8WkJo76EMxObrLcsZLZnug","LWh3dMRC5oQuaDxpnbrcwLsPnbe","YyrKddPO3o0vzyxdApCcxSasn4d","OcPfdKpKKoDlFfx4vTTcYaoynSe","QsoZdHfU5owaoyxHsaYciSR2n3d","WTSrdoZvmowpJax5xvjciBpgnIg","IjL5dRsJvoXd30xiIgKc6Tsbnwe","A2yDd8RGyodSx6x01cycqhnVn0b","NAvEdnneRoTvm1xb0EIcTi1NnJf","Byihd4WHeotSSUxidF2cuZnvndX","ScdadqRUeoEIZvx6BEuc64hEn1c","Hj4gdVg7Xo26eLxp2LAchl3snZb","EzFjddfWLogPM7xcwAbcc9VmnRf","PHcPdplk7o6kBIxx9mOcxKyYnrf","NQI4dRZ8RoUOxcxLhndc6T0anne","LoOBdMWJho7mkXx7RAJchZvdnme","MTRSddd8qowF8OxQvlYcTURznwd","F7hodNTEMoKoJCxSQ4nco1XtnPf","ZZj9dnpxQovYrsxQzKwca1BSnch","Jl7fdiSwio0V8Lxn9CecBkY3nrb","BqLhdIur7oxlKRxueclcpC6vnYq","UmRAdazDkoK2S6xgMeVcfmNBnFd","NpVJdmQPCoVcf3xHepfcTkYYnIe"],"page":{"elements":[{"text_run":{"content":"3.5  远程数据库","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1}},"parent_id":""},{"block_id":"FREkdDypboAYtvxkbW9c9bgfnPc","block_type":50,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","reference_synced":{"source_block_id":"Cq3adg3MjsLkN1bqHGwc5oVVnKj","source_document_id":"V3fHdvfwIoScWWxqvo4ctMv7nUE"}},{"block_id":"Dkh8d5mpuozUXXxGWkKcIlLRn4c","block_type":2,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","text":{"elements":[{"text_run":{"content":"连接远程数据库进行操作，由于需要将数据库开放至公网，请做好安全策略！如限制账号访问权限、使用高位端口等。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"SmfJd8WkJo76EMxObrLcsZLZnug","block_type":2,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","text":{"elements":[{"text_run":{"content":"使用场景：实时获取公司内部数据","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LWh3dMRC5oQuaDxpnbrcwLsPnbe","block_type":2,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","text":{"elements":[{"text_run":{"content":"支持数据库：Mysql、Postgre","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YyrKddPO3o0vzyxdApCcxSasn4d","block_type":2,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","text":{"elements":[{"text_run":{"content":"由于未知原因，本插件无法上传至扣子商店，所以只能公开代码，请自己创建插件使用。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OcPfdKpKKoDlFfx4vTTcYaoynSe","block_type":3,"heading1":{"elements":[{"text_run":{"content":"输入/输出参数","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"QsoZdHfU5owaoyxHsaYciSR2n3d","block_type":2,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","text":{"elements":[{"text_run":{"content":"输入参数：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WTSrdoZvmowpJax5xvjciBpgnIg","block_type":27,"image":{"align":2,"height":869,"token":"F20abhRqro1CUTxq5sxc14NfnPf","width":1920},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"IjL5dRsJvoXd30xiIgKc6Tsbnwe","block_type":12,"bullet":{"elements":[{"text_run":{"content":"host  --- 数据库地址","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"A2yDd8RGyodSx6x01cycqhnVn0b","block_type":12,"bullet":{"elements":[{"text_run":{"content":"port --- 数据库端口","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"NAvEdnneRoTvm1xb0EIcTi1NnJf","block_type":12,"bullet":{"elements":[{"text_run":{"content":"user --- 用户名","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"Byihd4WHeotSSUxidF2cuZnvndX","block_type":12,"bullet":{"elements":[{"text_run":{"content":"pwd --- 密码","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"ScdadqRUeoEIZvx6BEuc64hEn1c","block_type":12,"bullet":{"elements":[{"text_run":{"content":"database --- 数据库","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"Hj4gdVg7Xo26eLxp2LAchl3snZb","block_type":12,"bullet":{"elements":[{"text_run":{"content":"sql --- 原生SQL语句","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"EzFjddfWLogPM7xcwAbcc9VmnRf","block_type":2,"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe","text":{"elements":[{"text_run":{"content":"输出参数","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"PHcPdplk7o6kBIxx9mOcxKyYnrf","block_type":27,"image":{"align":2,"height":398,"token":"T8e8byMTQoUOqQxVaIccu9STnCb","width":1470},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"NQI4dRZ8RoUOxcxLhndc6T0anne","block_type":12,"bullet":{"elements":[{"text_run":{"content":"data --- 执行结果","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"LoOBdMWJho7mkXx7RAJchZvdnme","block_type":12,"bullet":{"elements":[{"text_run":{"content":"msg --- 消息","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"MTRSddd8qowF8OxQvlYcTURznwd","block_type":3,"heading1":{"elements":[{"text_run":{"content":"进行测试","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"F7hodNTEMoKoJCxSQ4nco1XtnPf","block_type":24,"children":["AOoedHlz5ocV6wxBC0ac7sIan1g","BdRmdauXkovfyTx9ZjUcueTRnRh"],"grid":{"column_size":2},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"AOoedHlz5ocV6wxBC0ac7sIan1g","block_type":25,"children":["WvHqdXELWoruZDx0kWFcN7hknMc","WQqydsCj1ohalPxkWh0cp4JMnEQ"],"grid_column":{"width_ratio":50},"parent_id":"F7hodNTEMoKoJCxSQ4nco1XtnPf"},{"block_id":"WvHqdXELWoruZDx0kWFcN7hknMc","block_type":2,"parent_id":"AOoedHlz5ocV6wxBC0ac7sIan1g","text":{"elements":[{"text_run":{"content":"查询数据","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WQqydsCj1ohalPxkWh0cp4JMnEQ","block_type":27,"image":{"align":2,"height":750,"token":"MqAAb8rjkohAsfxQu5ycA7c9nzf","width":412},"parent_id":"AOoedHlz5ocV6wxBC0ac7sIan1g"},{"block_id":"BdRmdauXkovfyTx9ZjUcueTRnRh","block_type":25,"children":["RdrndATINobjiFxY2zlc5YpPnJc","Ncw6dDIqVodB4HxuK2xc9PCvnFe","Q8Ggd8PvvozmlhxrNO0cbJ22nke"],"grid_column":{"width_ratio":50},"parent_id":"F7hodNTEMoKoJCxSQ4nco1XtnPf"},{"block_id":"RdrndATINobjiFxY2zlc5YpPnJc","block_type":2,"parent_id":"BdRmdauXkovfyTx9ZjUcueTRnRh","text":{"elements":[{"text_run":{"content":"更新数据","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ncw6dDIqVodB4HxuK2xc9PCvnFe","block_type":27,"image":{"align":2,"height":738,"token":"AfWzbzZxfoZ21nxGMfYcSG7Qn5R","width":428},"parent_id":"BdRmdauXkovfyTx9ZjUcueTRnRh"},{"block_id":"Q8Ggd8PvvozmlhxrNO0cbJ22nke","block_type":2,"parent_id":"BdRmdauXkovfyTx9ZjUcueTRnRh","text":{"elements":[{"text_run":{"content":"","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"ZZj9dnpxQovYrsxQzKwca1BSnch","block_type":3,"heading1":{"elements":[{"text_run":{"content":"代码","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"Jl7fdiSwio0V8Lxn9CecBkY3nrb","block_type":4,"heading2":{"elements":[{"text_run":{"content":"Mysql","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"BqLhdIur7oxlKRxueclcpC6vnYq","block_type":14,"code":{"elements":[{"text_run":{"content":"from runtime import Args\nfrom typings.postgres.postgres import Input, Output\nimport pymysql  # 替换psycopg2为pymysql\nfrom typing import List, Dict, Any\n\ndef handler(args: Args[Input])->Output:\n    # 获取输入参数\n    host = args.input.host\n    port = int(args.input.port)  # 确保port是整数类型\n    user = args.input.user\n    pwd = args.input.pwd\n    database = args.input.database if hasattr(args.input, 'database') else \"mysql\"  # 默认数据库改为mysql\n    sql = args.input.sql  # 添加缺失的sql参数获取\n    \n    try:\n        # 连接MySQL数据库\n        conn = pymysql.connect(\n            host=host,\n            port=port,  # 现在port是整数类型\n            user=user,\n            password=pwd,\n            database=database,\n            charset='utf8mb4',  # MySQL需要指定字符集\n            cursorclass=pymysql.cursors.DictCursor  # 直接返回字典格式结果\n        )\n        cursor = conn.cursor()\n        \n        \n        # 执行SQL查询\n        cursor.execute(sql)\n        \n        # 获取查询结果\n        if sql.strip().lower().startswith('select'):\n            columns = [desc[0] for desc in cursor.description]\n            rows = cursor.fetchall()\n            data = [dict(zip(columns, row)) for row in rows]\n        else:\n            data = []\n            conn.commit()\n        \n        # 关闭连接\n        cursor.close()\n        conn.close()\n        \n        return {\n            \"msg\": \"执行成功\",\n            \"data\": data\n        }\n        \n    except Exception as e:\n        return {\n            \"msg\": f\"执行失败: {str(e)}\",\n            \"data\": []\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"        }","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"wrap":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"UmRAdazDkoK2S6xgMeVcfmNBnFd","block_type":4,"heading2":{"elements":[{"text_run":{"content":"Postgre","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"},{"block_id":"NpVJdmQPCoVcf3xHepfcTkYYnIe","block_type":14,"code":{"elements":[{"text_run":{"content":"from runtime import Args\nfrom typings.postgres.postgres import Input, Output\nimport psycopg2\nfrom typing import List, Dict, Any\n\ndef handler(args: Args[Input])->Output:\n    # 获取输入参数\n    host = args.input.host\n    port = args.input.port\n    user = args.input.user\n    pwd = args.input.pwd\n    database = args.input.database if hasattr(args.input, 'database') else \"postgres\"\n    sql = args.input.sql\n    \n    try:\n        # 连接PostgreSQL数据库\n        conn = psycopg2.connect(\n            host=host,\n            port=port,\n            user=user,\n            password=pwd,\n            database=database  # 使用传入的数据库名\n        )\n        cursor = conn.cursor()\n        \n        \n        # 执行SQL查询\n        cursor.execute(sql)\n        \n        # 获取查询结果\n        if sql.strip().lower().startswith('select'):\n            columns = [desc[0] for desc in cursor.description]\n            rows = cursor.fetchall()\n            data = [dict(zip(columns, row)) for row in rows]\n        else:\n            data = []\n            conn.commit()\n        \n        # 关闭连接\n        cursor.close()\n        conn.close()\n        \n        return {\n            \"msg\": \"执行成功\",\n            \"data\": data\n        }\n        \n    except Exception as e:\n        return {\n            \"msg\": f\"执行失败: {str(e)}\",\n            \"data\": []\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"        }","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"wrap":false}},"parent_id":"WCt0dwBHTollf9xtyzfclPkKnWe"}]}